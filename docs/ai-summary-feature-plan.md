# AI 总结链接功能 - 实现计划

## 📌 功能概述

为 Slidememos 添加 AI 总结链接功能，帮助用户快速理解网页内容。

## 🎯 功能需求

### 场景 1：新建卡片时检测链接
- **触发条件**：用户在新建卡片的输入框中输入 URL
- **交互**：自动检测 URL，显示浮动的"✨ AI总结"按钮
- **位置**：输入框右下角或内部右侧
- **行为**：点击按钮后，自动获取网页内容并生成总结

### 场景 2：已保存的 URL 卡片
- **触发条件**：卡片类型为 `type: 'url'`
- **交互**：在卡片上显示"✨ AI总结"按钮
- **位置**：卡片右上角或底部操作栏
- **行为**：点击按钮后，生成总结并更新卡片内容

## 🔧 技术方案

### 1. 网页内容获取

**方案：Jina Reader API**
```
URL: https://r.jina.ai/[目标URL]
优点：
- ✅ 免费，无需 API Key
- ✅ 自动清理内容（去除广告、导航等）
- ✅ 返回 Markdown 格式
- ✅ 解决 CORS 问题
- ✅ 支持各种网页类型

实现：
const response = await fetch(`https://r.jina.ai/${url}`)
const markdown = await response.text()
```

### 2. AI 总结服务

**推荐方案（按优先级）：**

#### 方案 A：Chrome 内置 AI（Gemini Nano）
```javascript
// 检查是否可用
if (window.ai && window.ai.canCreateTextSession) {
  const session = await window.ai.createTextSession()
  const summary = await session.prompt(
    `请用中文总结以下内容，保持简洁（3-5 句话）：\n\n${content}`
  )
}
```

**优点**：
- 免费
- 本地运行，隐私保护
- 无需 API Key

**缺点**：
- 需要用户启用实验性功能
- 浏览器兼容性限制

#### 方案 B：用户自己的 API Key
```javascript
// 在设置中配置
settings: {
  aiProvider: 'openai' | 'claude' | 'custom',
  apiKey: string,
  apiEndpoint?: string
}
```

**优点**：
- 功能强大
- 效果更好
- 用户可选择

**缺点**：
- 需要用户配置
- 有使用成本

### 3. UI/UX 设计

#### 场景 1：新建卡片
```
┌─────────────────────────────────┐
│ 输入框                          │
│ https://example.com             │
│                      [✨ AI总结] │ ← 浮动按钮
└─────────────────────────────────┘

状态：
- 检测到 URL：显示按钮（淡入动画）
- 点击按钮：显示加载状态
- 总结完成：插入到输入框内容中
```

#### 场景 2：URL 卡片
```
┌─────────────────────────────────┐
│ 🔗 Vue.js 官方文档    [✨ AI总结]│
│ https://vuejs.org               │
│                                 │
│ [总结内容区域]                  │
└─────────────────────────────────┘

状态：
- 默认：显示按钮
- 点击：显示加载状态
- 完成：展开显示总结内容
```

## 📁 文件结构

```
src/
├── composables/
│   └── useAISummary.ts          # AI 总结逻辑
├── utils/
│   ├── jina-reader.ts           # Jina Reader API 封装
│   └── ai-providers.ts          # AI 服务提供商封装
├── sidepanel/
│   └── components/
│       ├── MemoCard.vue         # 修改：添加 AI 总结按钮
│       ├── MemoEditor.vue       # 修改：添加 URL 检测和按钮
│       └── AISummaryButton.vue  # 新增：AI 总结按钮组件
└── types/
    └── ai.ts                    # 新增：AI 相关类型定义
```

## 🚀 实现步骤

### 阶段 1：基础功能（MVP）
**预计时间：1-2 天**

1. **创建 Jina Reader 工具函数** (2h)
   - 封装 fetch 请求
   - 错误处理
   - 内容清理

2. **创建 AI 总结 Composable** (3h)
   - 实现 Chrome 内置 AI 调用
   - 状态管理（loading, error, result）
   - 错误处理和重试逻辑

3. **场景 1：新建卡片 URL 检测** (3h)
   - 在 MemoEditor.vue 中添加 URL 检测
   - 显示浮动按钮
   - 集成 AI 总结功能

4. **场景 2：URL 卡片按钮** (2h)
   - 在 MemoCard.vue 中判断 type === 'url'
   - 添加 AI 总结按钮
   - 显示总结结果

### 阶段 2：优化和扩展（可选）
**预计时间：1-2 天**

1. **支持多种 AI 服务** (4h)
   - 添加设置页面
   - 支持 OpenAI/Claude API
   - API Key 管理

2. **UI/UX 优化** (3h)
   - 更好的加载动画
   - 总结结果的展示优化
   - 错误提示优化

3. **功能增强** (3h)
   - 总结结果缓存
   - 支持重新生成总结
   - 总结长度可配置

## 🧪 测试计划

### 功能测试
- [ ] URL 检测准确性
- [ ] Jina Reader API 调用成功
- [ ] AI 总结生成成功
- [ ] 总结内容插入正确
- [ ] 错误处理正确

### 兼容性测试
- [ ] Chrome 内置 AI 可用性检测
- [ ] 不同类型网页（HTML/PDF/SPA）
- [ ] 网络错误处理
- [ ] API 限流处理

### 用户体验测试
- [ ] 按钮显示时机合适
- [ ] 加载状态清晰
- [ ] 总结质量满意
- [ ] 操作流畅

## 📊 技术难点和解决方案

### 难点 1：Chrome 内置 AI 兼容性
**问题**：不是所有用户都启用了实验性功能
**解决**：
- 检测 API 可用性
- 提供降级方案（提示用户配置 API Key）
- 提供使用指南

### 难点 2：网页内容提取质量
**问题**：某些网页可能提取失败或内容不完整
**解决**：
- 使用 Jina Reader 的高质量提取
- 添加错误提示
- 允许用户重试

### 难点 3：总结质量控制
**问题**：AI 总结可能不够准确或太长
**解决**：
- 优化 Prompt（指定长度、语言、格式）
- 允许用户重新生成
- 提供总结长度选项

## 💰 成本估算

### 免费方案（Chrome 内置 AI + Jina Reader）
- Jina Reader：免费
- Chrome 内置 AI：免费
- **总成本：0 元**

### 付费方案（用户自己的 API Key）
- 由用户承担
- OpenAI GPT-3.5：约 $0.002/次
- Claude：约 $0.003/次

## 📅 时间线

- **MVP 开发**：1-2 天
- **测试和优化**：0.5-1 天
- **文档和发布**：0.5 天
- **总计**：2-4 天

## 🎯 成功指标

- [ ] 功能正常运行，无重大 Bug
- [ ] 总结质量满意度 > 80%
- [ ] 响应时间 < 10 秒
- [ ] 用户使用率 > 30%（有 URL 卡片的用户）

## 📝 后续优化方向

1. **多语言支持**：自动检测网页语言，生成对应语言的总结
2. **总结模板**：提供不同的总结风格（简洁/详细/要点）
3. **批量总结**：支持一次性总结多个链接
4. **总结历史**：保存总结历史，避免重复请求
5. **分享功能**：分享总结结果到其他平台

---

**文档版本**：v1.0
**创建日期**：2026-02-07
**最后更新**：2026-02-07
**负责人**：Slidememos Team
